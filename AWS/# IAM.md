# IAM.md
- 1AWSアカウントで5000ユーザまで作成可能
- 1AWSアカウントで100グループまで作成可能
- ユーザはどのリージョンでもAWSサービスを利用できる
- IAMで使用する認証情報
	- アクセスキーID/シークレットアクセスキー
	- X.509 Certificate
		- SOAP形式のAPIリクエスト用
		- OpenSSLなどで証明書をつくりアップロード
	- MFA(多要素認証)
		- ハードウェアMFA、仮想MFS、SMS MFA(モバイルデバイスのSMS利用)より選択
		- AWSルートアカウントはMFSで保護し通常利用しない。
- IAM認証情報レポート
	- 認証情報ライフサイクルの要件の結果を監査可能
	- ユーザの作成日時、最後にパスワードが使われた・変更された日時、MFA利用有無
	- AccessKeyがActiveか、ローテートした日時、最後に利用したAWSサービス、証明書はActiveか、証明書が最後にローテートした日時
- ポリシーの種類
	- AWS管理ポリシー
		- AWSが作成及び管理するスタンドアロンポリシー。
	- カスタマーポリシー
	- インラインポリシー
- ポリシーの対象
	- ユーザベース、リソースベース(S3,SQS)
	- リソースベースのポリシーによるクロスアカウントアクセス
		- S3,SQS,SNSなどで利用可能。
		- 例：別アカウントに自アカウントのBucketへのアクセス許可
- AccessAdvisor,Service Last Accessed Data
	- 最後にAWSサービスにアクセスした日時
	- IAMの最小限の特権に関する設定に利用。最近利用されていないアクセス許可を確認できる。
- IAMロール
	- EC2にはIAMロールを利用
		- 認証情報はSTSで生成
		- EC2上のアクセスキーの管理が容易
		- 自動的に認証情報のローテーションが行われる
		- 認証情報の外部漏洩のリスク低減
- STS(AWS Security Token Service)
	- 一時的にトークンを発行するサービス
	- 動的にIAMユーザを作成し、ポリシー適用できる
	- Temporary Security Credentials
		- AWSに対する、一時的な認証情報を作成する仕組み
		- AccessKey,SecretAccessKey,SessionTokenを発行
		- 認証情報の有効期限
	- AWS STS in all AWS regions
		- STSのエンドポイントが全リージョンに拡張 
- IAMロールによるクロスアカウントアクセス
	- アカウントAのユーザにアカウントBのIAMロールを紐づける。
		- これにより、該当ユーザはアカウントBのS3データを更新できたり。
		- 開発アカウント側のAssumeRole(想定される役割)を付与。
		- 本番側S3にも誰にのAssumeRoleを付与。
	- MFA保護もできる
- Identity Federation(ID連携)
	- 企業・組織の認証機能とAWS認証を紐づける機能
		- 例；LDAP認証したユーザに対してS3アクセスを可能にしたり。
	- IAMはOpenID ConnectまたはSAML2.0と互換性のあるIdP(ID Provider)をサポート
	- ユースケース
		- SAML2.0を使用したIDフェデレーション
			- 組織内の全員についてIAMユーザを作成しなくてもAWSを利用可能
			- 組織で生成したSAMLアサーションを認証レスポンスの一部として使用し、一時的セキュリティ認証情報を取得
		- SAML2.0によるSSO Federation
			- SAML2.0互換IdP及びIAMロールを使用した管理コンソールへのフェデレーションアクセス
			- AssumeRoleWithSAML APIを直接呼び出す代わりにAWS SSP Endpoint(AWSが用意しているシングルサインオン用のURL)を使用
			- エンドポイントはユーザの代わりにAPIを呼び出し、URLを返すとそれによってマネジメントコンソールへリダイレクト
		- Console Federation(SAMLを使わない)
			- 既存のIdPによる管理コンソールへのシングルサインオン
			- Federation proxyでSTS,directoryを中継する。
			- STSより一時的な認証情報を取得するためのカスタムフェデレーションブローカーを利用
			- AssumeRole APIの利用
			- メリット
				- 企業内、イントラネットからのみアクセス可能なログイン
				- 既存のユーザ情報、権限ベース、ポリシー管理が可能
				- アカウント管理が統合される
		- Web Identity Federation
			- モバイルアプリから一時的なAWSセキュリティ認証情報を必要に応じて動的にリクエスト
			- 現在Google,Facebook,Amazon,twitter,Amazon Cognito,OIDC準拠のIdPに対応

## IAMのベストプラクティス
1.AWSアカウント(ルート)のアクセスキーをロックする
2.個々のIAMユーザを作成する
3.IAMユーザへのアクセス許可を割り当てるためにグループを使う
4.最小限の特権を認める
5.ユーザのために強度の高いパスワードポリシーを設定する
6.特権ユーザに対して、MFAを有効化する
7.EC2で作動するアプリに対し、ロールを使用する
8.認証情報を共有するのではなく、ロールを使って委託する
9.認証情報を定期的にローテーションする
10.不要な認証情報の削除
11.追加セキュリティに対するポリシー条件を使用する
12.AWSアカウントのアクティビティの監視
