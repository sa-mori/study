# EBS&Glacier&StorageGateway&EFS&S3.md

## EBS
- AZ毎に独立しているため、同じAZ内のインスタンスにつける
- snapshotから任意のAZに復元できる
- ユースケースにあわせたボリュームタイプを選択できる
- 1GB(もしくは4GB)～16TBまで
- パラメータチューニング
	- 高スループットで読み込みが主の場合は先読み(Read ahead)を1MBにすることを推奨
- 新ボリューム
	- st1/sc1。ETL、DWH、ログ処理、EMR等のシーケンシャルアクセスにむいている。
- EBSのパフォーマンスをみる要素
	- 1.EC2インスタンス側のスループット上限
	- 2.EBSのI/O命令の量
	- 3.EBSのスループット上限
- snapshot
	-　2世代目以降は差分データを保存する差分バックアップ。
- 暗号化
	- EBS作成時に暗号化を指定でAES-256によって暗号化処理。
	- ハードウェア機能のため、意識する必要はない。パフォーマンスへの影響も極めて小さい。
	- 暗号キーはKeyManagementServiceで管理
	- ボリューム作成後に暗号化したければ、snapshotからEBS作成時に指定
	- ブートボリュームではないデータボリュームが対象。

# Glacier
- セキュア
	- やり取りはすべてSSL通信
	- 同一リージョン内のみでのデータ保管
	- デフォルトで自動サーバサイド暗号化(AES256)
	- IAMとの連携によるアクセス管理
- 構成
	- Vault
		- 格納アーカイブ数の制限なし
		- 1アカウントの1リージョンごとに1000個まで作成可能
		- IAMによるアクセス制限指定可能
		- Vault毎にデフォルトのSNS通知設定可能
	- Archive
		- 格納データは更新不可
		- マルチパートアップロードに対応
		- 1アーカイブ最大40TBまで

# AWS Storage Gateway
- 1.オンプレ環境と連携可能なデータバックアップおよび、クラウドストレージを提供
- 2.AWS上で大容量オンラインおよび、バップアックストレージを提供
- 方式
	- Gateway-Stored Volumes
		- オンプレの特定ディスクボリュームを自動的にAWS側に複製
	- Gateway-Cached Volumes
		- ローカルキャッシュストレージとして利用
	- Gateway-VTL
		- 物理テープライブラリの代替として利用
- Snapshotのリージョン間転送機能を利用することで他リージョンでのEBSへのリストア、もしくはGateway-Cached Volumeへのリストアが可能
## セキュア
- データのやり取りはすべてSSL
- クラウドストレージ側は暗号化(AES-256)

# EFS
- シンプル
	- 保存された合計容量で課金
- 柔軟・スケーラブル
	- ペタバイトまで保存可能
	- SSDベースで高速。保存容量に応じてスループット・IOPSが向上
	- 数千のNFS同時接続が可能
- 高耐久性
	- 複数のAZに複製されて保存
- 接続先「マウントターゲット」
	- AZ毎にマウントのエンドポイントがある
	- マウントターゲットごとにSG設定ができる
- 2つのパフォーマンスモード
- 料金の容量単価
	- S3 < EBS < EFS

# S3
- 概要
	- 容量無制限
		- 1ファイル最大5TBまで。
		- 通常は5GB、マルチパートアップロードを使うと5TBまで可能
	- データ容量に依存しない性能
- データストレージクラス
	- 用途に応じて格納するストレージクラスを選択
		- 標準低頻度アクセスストレージ
		- 低冗長化ストレージ
		- アーカイブ(Glacier)
- Consistency Model
	- 更新・削除においては古いものが参照される可能性がある。
- アクセス管理
	- ユーザポリシー(IAM)
	- バケットポリシー(S3バケットごと)
	- ACL
		- バケット×ユーザで権限を付けられる
- VPCエンドポイント
	- NAT GatewayやNATインスタンスを経由せず、接続ができる
		- VPCでEndpointを作成し、S3と通信したいサブネットにルーティングを追加
		- Endpoint作成時にアクセスポリシーでBucketや送信元VPCの指定までが可能
- セキュリティ
	- 暗号化
		- サーバサイド、クライアントサイドいずれかで暗号化する。
	- Pre-signed Object URL(署名付きURL)
		- SDKを利用して一時的なアクセスを可能にするURLを発行する
- Webサイトホスティング
	- CORS(Cross-origin Resource Sharing)
		- クロスドメイン通信をする場合に利用
		- ブラウザにはクロスサイトスクリプティングを防止するため、クロスドメイン通信を拒否する仕組みが実装されている。
- Lifecycle管理
	- バケット内のオブジェクトに対して、削除もしくはストレージクラスの変更に関する自動設定が可能
	- オブジェクトの更新日をベースに日単位で指定が可能
	- 毎日0:00UTCに処理がキューイングされ順次実行
- アーカイブおよび復元
	- オブジェクトのデータはGlacierに移動
	- S3上のデータを削除することでGlacierのデータも削除される
	- オブジェクトごとに復元
	- リストアには3-5時間
- イベント通知
	- SNS
	- SQS
	- Lambda
- クロスリージョンレプリケーション
- S3 Transfer Acceleration
	- 高速化エンドポイントを使用して、地域ごとに最適化された高速なデータ転送ができる。
	- 中央のバケットに対して世界中のお客様からアップロードが行われる。
	- 大陸間で定期的にギガバイトからテラバイト単位のデータを転送する。
	- Amazon S3 へのアップロード時にインターネット経由で利用可能な帯域幅を十分に活用できていない
- パフォーマンスの最適化
	- 定常的にPUT/LIST/DELETEが100RPSを超える、もしくはGETが300RPSを超える場合、キー名先頭部分の文字列をランダムにすることを推奨
	- GETをRANGE GETを活用するとマルチスレッド環境では高速に処理ができる
- DX経由でのS3へのアクセス
- EMR,Redshift,諸々、処理の中心にS3がいれば疎結合、安全。
	- オンプレルータ側のIPアドレスでNASさせることでVPC経由をせず通信が可能